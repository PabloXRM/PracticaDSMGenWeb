@model List<DSM.Controllers.CarritoItemViewModel>

@{
    ViewData["Title"] = "Carrito";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="section">
    <div class="section-inner">
        <header class="section-header section-header-row">
            <h2>Carrito</h2>
            <form asp-action="Clear" method="post">
                <button class="btn ghost-btn btn-sm" type="submit">Vaciar</button>
            </form>
        </header>

        @if (Model == null || Model.Count == 0)
        {
            <p>Tu carrito está vacío.</p>
            <a class="btn primary-btn" asp-controller="Tienda" asp-action="Catalogo">Ir al catálogo</a>
        }
        else
        {
            <div class="cart-list">
                @{
                    double total = 0;
                }
                @foreach (var it in Model)
                {
                    var subtotal = it.Producto.Precio * it.Cantidad;
                    total += subtotal;

                    <article class="cart-row">
                        <div>
                            <div class="cart-title">@it.Producto.Descripcion</div>
                            <div class="cart-muted">
                                @String.Format("{0:0.00} €", it.Producto.Precio)
                            </div>
                        </div>

                        <div class="cart-right">
                            <!-- Cantidad editable -->
                            <form asp-action="UpdateCantidad" method="post" class="cart-cantidad-form" style="display: flex; gap: 8px; align-items: center;">
                                <input type="hidden" name="id" value="@it.Producto.Id" />
                                <label for="cantidad-@it.Producto.Id" style="font-size: 0.85rem;">Cantidad:</label>
                                <input type="number" id="cantidad-@it.Producto.Id" name="cantidad" value="@it.Cantidad" min="1" max="999" style="width: 60px; padding: 4px 8px; border: 1px solid rgba(0,0,0,0.1); border-radius: 6px; font-size: 0.9rem;" />
                                <button type="submit" class="btn ghost-btn btn-sm" style="padding: 4px 8px; font-size: 0.8rem;">Actualizar</button>
                            </form>

                            <div class="cart-total">@String.Format("{0:0.00} €", subtotal)</div>
                            <form asp-action="Remove" method="post" style="display: inline;">
                                <input type="hidden" name="id" value="@it.Producto.Id" />
                                <button class="btn ghost-btn btn-sm" type="submit">Quitar</button>
                            </form>
                        </div>
                    </article>
                }

                <div class="cart-summary">
                    <span>Total</span>
                    <strong>@String.Format("{0:0.00} €", total)</strong>
                </div>
            </div>
        }
    </div>
    <br />
    <form asp-action="Checkout" method="get">
        <button class="btn primary-btn" type="submit">Finalizar pago</button>
    </form>

</section>
