@{
    ViewData["Title"] = "Novedades";
}
@model DSM.Models.HomeIndexViewModel
@using PracticaDSMGen.ApplicationCore.Enumerated.PracticaDSM

<div class="product-search-wrap" style="margin-bottom:16px;">
    <form class="product-search-form" method="get" asp-controller="Home" asp-action="Resultados">
        <input class="form-input product-search-input"
               name="q"
               value="@Model.Q"
               placeholder="Buscar por nombre, artista, descripción..." />

        <select class="form-select product-search-select" name="estilo">
            <option value="">Todos los estilos</option>
            @foreach (EstiloEnum e in Enum.GetValues(typeof(EstiloEnum)))
            {
                <option value="@((int)e)" selected="@(Model.Estilo.HasValue && (int)Model.Estilo.Value == (int)e)">
                    @e
                </option>
            }
        </select>

        <select class="form-select product-search-select" name="formato">
            <option value="">Todos los formatos</option>
            @foreach (FormatoEnum f in Enum.GetValues(typeof(FormatoEnum)))
            {
                <option value="@((int)f)" selected="@(Model.Formato.HasValue && (int)Model.Formato.Value == (int)f)">
                    @f
                </option>
            }
        </select>

        <button class="btn primary-btn" type="submit">Buscar</button>
        <a class="btn search-clear" asp-controller="Home" asp-action="Index">Limpiar</a>
    </form>
</div>

<section class="hero">
    <div class="hero-static">
        <img src="~/img/banner.png" alt="Promoción destacada" />
    </div>
    <div class="hero-dots">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
    </div>
</section>
<br>
<br>
<hr>

@if (Model.ProductosRecomendados != null && Model.ProductosRecomendados.Count > 0)
{
    <section class="section section-recommendation">
        <div class="section-header">
            <h2>Recomendaciones especiales</h2>
        </div>

        <div class="cards-row-recommendations">
            @foreach (var producto in Model.ProductosRecomendados)
            {
                <article class="disc-card featured">
                    @{
                        var placeholder = Url.Content("~/img/cd3.png");
                        var fotoRaw = producto.Fotos;

                        string imagenPath = placeholder;

                        if (!string.IsNullOrWhiteSpace(fotoRaw))
                        {
                            var f = fotoRaw.Trim().Replace("\\", "/");

                            // Si es URL absoluta
                            if (f.StartsWith("http", StringComparison.OrdinalIgnoreCase))
                            {
                                imagenPath = f;
                            }
                            else
                            {
                                // Normalizar: quitar / inicial y "img/" si ya viene incluido
                                f = f.TrimStart('/');
                                if (f.StartsWith("img/", StringComparison.OrdinalIgnoreCase))
                                    f = f.Substring(4);

                                imagenPath = Url.Content("~/img/" + f);
                            }
                        }
                    }

                    <img src="@imagenPath"
                         alt="@producto.Descripcion"
                         onerror="this.onerror=null; this.src='@placeholder';" />

                    <div class="card-info">
                        <h3>@producto.Descripcion</h3>
                        <p class="artist">@producto.Artista</p>
                        <p class="price">@producto.Precio.ToString("C")</p>
                        <div class="card-actions">
                            <a class="btn primary-btn" asp-controller="Tienda" asp-action="Producto" asp-route-id="@producto.Id">Ver detalles</a>
                            <a class="btn secondary-btn" asp-controller="Carrito" asp-action="AñadirAlCarrito" asp-route-id="@producto.Id">Añadir al carrito</a>
                        </div>
                    </div>
                </article>
            }
        </div>

        <div class="section-cta">
            <p style="text-align:center; color:#666;">Descubre los mejores álbumes de nuestro catálogo</p>
        </div>
    </section>
    <hr>
}

<section class="section section-reserve">
    <div class="section-header">
        <h2>Reserva el último disco <strong>LUX</strong></h2>
    </div>

    <div class="reserve-collage">
        <div class="reserve-left">
            <div class="reserve-img small">
                <img src="~/img/cd1.png" alt="Disco portada" />
            </div>
            <div class="reserve-img small">
                <img src="~/img/ros1.jpg" alt="Detalle disco" />
            </div>
        </div>

        <a class="reserve-right" asp-controller="Tienda" asp-action="Catalogo">
            <img src="~/img/ros2.jpg" alt="Reserva disco" />
            <div class="reserve-overlay">
                <span>Reservar ahora</span>
            </div>
        </a>
    </div>
</section>



<section class="section section-offers">
    <div class="section-header section-header-row">
        <h2>Ofertas</h2>
        <a class="btn ghost-btn" asp-controller="Tienda" asp-action="Catalogo">Ver todo</a>
    </div>

    <div class="offers-grid">
        <!-- OFERTA 1 -->
        <article class="offer-card">
            <div class="offer-media">
                <span class="offer-badge">-30%</span>
                <img src="~/img/cold1.webp" alt="Oferta 1" />
            </div>

            <div class="offer-body">
                <h3 class="offer-title">Vinilo “Moon Music”</h3>
                <p class="offer-sub">Edición limitada · LP</p>

                <div class="offer-price">
                    <span class="offer-old">29,99 €</span>
                    <span class="offer-new">20,99 €</span>
                </div>

                <div class="offer-actions">
                    <a class="btn ghost-btn btn-sm" asp-controller="Tienda" asp-action="Catalogo">Ver</a>
                    <a class="btn primary-btn btn-sm" asp-controller="Carrito" asp-action="Index">Añadir</a>
                </div>
            </div>
        </article>

        <!-- OFERTA 2 -->
        <article class="offer-card">
            <div class="offer-media">
                <span class="offer-badge">-40%</span>
                <img src="~/img/cold2.webp" alt="Oferta 2" />
            </div>

            <div class="offer-body">
                <h3 class="offer-title">Vinilo “X&Y”</h3>
                <p class="offer-sub">Nuevo stock · 2xLP</p>

                <div class="offer-price">
                    <span class="offer-old">34,99 €</span>
                    <span class="offer-new">20,99 €</span>
                </div>

                <div class="offer-actions">
                    <a class="btn ghost-btn btn-sm" asp-controller="Tienda" asp-action="Catalogo">Ver</a>
                    <a class="btn primary-btn btn-sm" asp-controller="Carrito" asp-action="Index">Añadir</a>
                </div>
            </div>
        </article>

        <!-- OFERTA 3 -->
        <article class="offer-card">
            <div class="offer-media">
                <span class="offer-badge">-25%</span>
                <img src="~/img/cold3.webp" alt="Oferta 3" />
            </div>

            <div class="offer-body">
                <h3 class="offer-title">Vinilo “Parachutes”</h3>
                <p class="offer-sub">Top ventas · LP</p>

                <div class="offer-price">
                    <span class="offer-old">23,99 €</span>
                    <span class="offer-new">17,99 €</span>
                </div>

                <div class="offer-actions">
                    <a class="btn ghost-btn btn-sm" asp-controller="Tienda" asp-action="Catalogo">Ver</a>
                    <a class="btn primary-btn btn-sm" asp-controller="Carrito" asp-action="Index">Añadir</a>
                </div>
            </div>
        </article>
    </div>
</section>


<section class="section section-novedades section-70s">
    <div class="section-inner">
        <div class="section-header section-header-row">
            <div>
                <h2>Novedades 70s</h2>
                <div class="section-subline">Sonido clásico · Eagles en vinilo</div>
            </div>

            <a class="btn ghost-btn" asp-controller="Tienda" asp-action="Catalogo">Ver todo</a>
        </div>

        <div class="new70-grid">
            <!-- Eagles 1 -->
            <article class="new70-card">
                <div class="new70-media">
                    <img src="~/img/eagle.jpeg" alt="Eagles - Vinilo 1" />
                </div>

                <div class="new70-info">
                    <h3 class="new70-title">Eagles · The Classic Era</h3>
                    <p class="new70-artist">Eagles</p>

                    <div class="new70-bottom">
                        <span class="new70-price">27,99 €</span>

                        <a class="btn primary-btn btn-sm"
                           asp-controller="Carrito" asp-action="AñadirAlCarrito"
                           asp-route-id="101">
                            Añadir al carrito
                        </a>
                    </div>
                </div>
            </article>

            <!-- Eagles 2 -->
            <article class="new70-card">
                <div class="new70-media">
                    <img src="~/img/eagle2.jpg" alt="Eagles - Vinilo 2" />
                </div>

                <div class="new70-info">
                    <h3 class="new70-title">Eagles · West Coast Nights</h3>
                    <p class="new70-artist">Eagles</p>

                    <div class="new70-bottom">
                        <span class="new70-price">29,99 €</span>

                        <a class="btn primary-btn btn-sm"
                           asp-controller="Carrito" asp-action="AñadirAlCarrito"
                           asp-route-id="102">
                            Añadir al carrito
                        </a>
                    </div>
                </div>
            </article>

            <!-- Eagles 3 -->
            <article class="new70-card">
                <div class="new70-media">
                    <img src="~/img/eagle3.jpg" alt="Eagles - Vinilo 3" />
                </div>

                <div class="new70-info">
                    <h3 class="new70-title">Eagles · Golden Vinyl</h3>
                    <p class="new70-artist">Eagles</p>

                    <div class="new70-bottom">
                        <span class="new70-price">25,99 €</span>

                        <a class="btn primary-btn btn-sm"
                           asp-controller="Carrito" asp-action="AñadirAlCarrito"
                           asp-route-id="103">
                            Añadir al carrito
                        </a>
                    </div>
                </div>
            </article>
        </div>
    </div>
</section>

